#include <iostream>
#include <fstream>
#include <string>
using namespace std;

// Simple Caesar cipher encryption
string encrypt(string text, int key) {
    for (int i = 0; i < text.length(); i++) {
        char c = text[i];
        if (isalpha(c)) {
            char base = isupper(c) ? 'A' : 'a';
            text[i] = (c - base + key) % 26 + base;
        }
    }
    return text;
}

// Simple Caesar cipher decryption
string decrypt(string text, int key) {
    return encrypt(text, 26 - key); // reversing the shift
}

// Function to save message to file
void saveMessage(string user, string msg) {
    ofstream file("log.txt", ios::app);
    if (file.is_open()) {
        file << user << ": " << msg << endl;
        file.close();
    }
}

int main() {
    string user1 = "User1";
    string user2 = "User2";
    int key = 3; // simple Caesar shift key

    cout << "=== Welcome to Crypto Chat Simulator ===\n";
    cout << "Messages are encrypted with Caesar Cipher.\n\n";

    string msg;
    bool turn = true; // true = user1, false = user2

    while (true) {
        if (turn) cout << user1 << ": ";
        else cout << user2 << ": ";

        getline(cin, msg);
        if (msg == "exit") break;

        string encrypted = encrypt(msg, key);
        saveMessage(turn ? user1 : user2, encrypted);

        string decrypted = decrypt(encrypted, key);
        cout << "Encrypted: " << encrypted << endl;
        cout << "Decrypted: " << decrypted << "\n\n";

        turn = !turn; // switch turn
    }

    cout << "Chat ended. Messages saved in log.txt\n";
    return 0;
}
